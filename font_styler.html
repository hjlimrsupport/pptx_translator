<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Font Styler - Match to Meiryo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            --glass-bg: rgba(15, 23, 42, 0.9);
            --accent: #38bdf8;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', system-ui, sans-serif;
        }

        body {
            background: #020617;
            background-image: radial-gradient(at 0% 0%, rgba(14, 165, 233, 0.1) 0, transparent 50%),
                radial-gradient(at 100% 100%, rgba(37, 99, 235, 0.1) 0, transparent 50%);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            padding: 48px;
            width: 100%;
            max-width: 550px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            text-align: center;
        }

        .badge {
            display: inline-block;
            padding: 5px 14px;
            border-radius: 20px;
            background: rgba(14, 165, 233, 0.15);
            color: var(--accent);
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 20px;
            border: 1px solid rgba(56, 189, 248, 0.2);
        }

        h1 {
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.4rem;
            font-weight: 900;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 0.95rem;
            margin-bottom: 40px;
            line-height: 1.6;
        }

        .drop-zone {
            display: block;
            width: 100%;
            background: rgba(15, 23, 42, 0.4);
            border: 2px dashed #334155;
            border-radius: 20px;
            padding: 40px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            margin-bottom: 30px;
        }

        .drop-zone:hover,
        .drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(14, 165, 233, 0.05);
            box-shadow: 0 0 20px rgba(14, 165, 233, 0.1);
        }

        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            pointer-events: none;
        }

        .upload-icon {
            width: 48px;
            height: 48px;
            color: #475569;
            transition: all 0.3s ease;
        }

        .drop-zone:hover .upload-icon,
        .drop-zone.drag-over .upload-icon {
            color: var(--accent);
            transform: translateY(-5px);
        }

        .drop-zone p {
            font-size: 0.95rem;
            color: #64748b;
        }

        .drop-zone b {
            color: var(--text-main);
            display: block;
            margin-bottom: 4px;
        }

        input[type="file"] {
            display: none;
        }

        .btn-process {
            width: 100%;
            padding: 18px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-process:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(14, 165, 233, 0.5);
        }

        .btn-process:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        #status {
            margin-top: 30px;
            padding: 18px;
            background: #020617;
            border-radius: 16px;
            font-size: 0.85rem;
            min-height: 100px;
            max-height: 180px;
            overflow-y: auto;
            color: #94a3b8;
            border: 1px solid #1e293b;
            text-align: left;
            line-height: 1.7;
        }

        .progress-bar-container {
            width: 100%;
            height: 6px;
            background: #1e293b;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: var(--accent);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--accent);
        }

        .footer {
            margin-top: 32px;
            font-size: 0.7rem;
            color: #475569;
            letter-spacing: 0.02em;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="badge">Performance Styler v1.0</div>
        <h1>Font Fixer</h1>
        <p class="subtitle">모든 텍스트의 폰트를 <b>Meiryo</b>로 즉시 통일합니다.<br>(PPTX & DOCX 지원)</p>

        <label for="fileInput" class="drop-zone" id="dropZone">
            <div class="drop-zone-content">
                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M12 16V8M12 8L9 11M12 8L15 11M7.8 20H16.2C17.8802 20 18.7202 20 19.362 19.673C19.9265 19.3854 20.3854 18.9265 20.673 18.362C21 17.7202 21 16.8802 21 15.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V15.2C3 16.8802 3 17.7202 3.32698 18.362C3.6146 18.9265 4.07354 19.3854 4.63803 19.673C5.27976 20 6.11984 20 7.8 20Z"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                <p id="fileNameDisplay"><b>클릭하여 파일 선택</b> 또는 여기에 드래그</p>
            </div>
            <input type="file" id="fileInput" accept=".pptx,.docx">
        </label>

        <button id="processBtn" class="btn-process">폰트 일괄 변환 시작</button>

        <div class="progress-bar-container" id="progressContainer">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div id="status">파일을 대기 중입니다...</div>

        <div class="footer">
            Client-side Processing • 100% Secure • Optimized Compression
        </div>
    </div>

    <script>
    const CONFIG = {
        pptx: {
            getFiles: (zip) => Object.keys(zip.files).filter(n => n.startsWith("ppt/slides/slide") && n.endsWith(".xml")),
            ns: "http://schemas.openxmlformats.org/drawingml/2006/main",
            pTag: "p", rPrTag: "rPr",
            isWord: false
        },
        docx: {
            getFiles: (zip) => Object.keys(zip.files).filter(n => n === "word/document.xml" || n.startsWith("word/header") || n.startsWith("word/footer")),
            ns: "http://schemas.openxmlformats.org/wordprocessingml/2006/main",
            pTag: "p", rPrTag: "rPr",
            isWord: true
        }
    };

    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const fileNameDisplay = document.getElementById('fileNameDisplay');
    const processBtn = document.getElementById('processBtn');
    const statusDiv = document.getElementById('status');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');

    function log(msg, replace = false) {
        if (replace) statusDiv.innerHTML = `<div>${msg}</div>`;
        else statusDiv.innerHTML += `<div>> ${msg}</div>`;
        statusDiv.scrollTop = statusDiv.scrollHeight;
    }

    function updateFileName(file) {
        fileNameDisplay.innerHTML = `<b>${file.name}</b> 선택됨 (변경하려면 클릭)`;
        log(`파일이 준비되었습니다: ${file.name}`);
    }

    // Drag & Drop Interactions
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        }, false);
    });

    dropZone.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            fileInput.files = files;
            updateFileName(files[0]);
        }
    }, false);

    fileInput.addEventListener('change', (e) => {
        if (fileInput.files.length > 0) {
            updateFileName(fileInput.files[0]);
        }
    });

    function applyMeiryo(doc, conf) {
        const prs = Array.from(doc.getElementsByTagNameNS(conf.ns, "rPr"));
        prs.forEach(pr => {
            if (conf.isWord) {
                let rFonts = pr.getElementsByTagNameNS(conf.ns, "rFonts")[0];
                if (!rFonts) {
                    rFonts = doc.createElementNS(conf.ns, "w:rFonts");
                    pr.prepend(rFonts);
                }
                rFonts.setAttribute("w:ascii", "Meiryo");
                rFonts.setAttribute("w:hAnsi", "Meiryo");
                rFonts.setAttribute("w:eastAsia", "Meiryo");
                rFonts.setAttribute("w:cs", "Meiryo");
                rFonts.setAttribute("w:hint", "eastAsia");
            } else {
                ["latin", "ea", "cs"].forEach(tag => {
                    let n = pr.getElementsByTagNameNS(conf.ns, tag)[0];
                    if (!n) {
                        n = doc.createElementNS(conf.ns, "a:" + tag);
                        pr.appendChild(n);
                    }
                    n.setAttribute("typeface", "Meiryo");
                });
            }
        });
    }

    async function processFile(zip, filePath, type) {
        const conf = CONFIG[type];
        const text = await zip.file(filePath).async("string");
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(text, "application/xml");
        applyMeiryo(xmlDoc, conf);
        const serializer = new XMLSerializer();
        zip.file(filePath, serializer.serializeToString(xmlDoc));
    }

    processBtn.addEventListener('click', async () => {
        const file = fileInput.files[0];
        if (!file) return alert("파일을 먼저 선택해주세요.");
        const ext = file.name.split('.').pop().toLowerCase();
        if (!CONFIG[ext]) return alert("지원하지 않는 형식입니다.");

        processBtn.disabled = true;
        progressContainer.style.display = 'block';
        log("파일 분석 및 처리 중...", true);
        
        try {
            const zip = await JSZip.loadAsync(file);
            const targetFiles = CONFIG[ext].getFiles(zip);
            for (let i = 0; i < targetFiles.length; i++) {
                await processFile(zip, targetFiles[i], ext);
                progressBar.style.width = ((i + 1) / targetFiles.length * 80) + '%';
            }
            log("최종 결과물 압축 중 (최적화)...");
            const blob = await zip.generateAsync({ 
                type: "blob",
                compression: "DEFLATE",
                compressionOptions: { level: 9 }
            });
            log(`처리 완료 (크기: ${(blob.size / 1024 / 1024).toFixed(2)} MB)`);
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `meiryo_${file.name}`;
            a.click();
            progressBar.style.width = '100%';
            log("변환된 파일이 다운로드 되었습니다.");
        } catch (e) { log(`에러 발생: ${e.message}`); } finally { processBtn.disabled = false; }
    });
    </script>
</body>

</html>